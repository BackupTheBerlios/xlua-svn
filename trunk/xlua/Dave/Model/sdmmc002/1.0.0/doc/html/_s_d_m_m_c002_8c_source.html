<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>

<title>SDMMC002.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">SDMMC002.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_s_d_m_m_c002_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/* CODE_BLOCK_BEGIN[SDMMC002.c] */</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">/*******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> Copyright (c) 2011, Infineon Technologies AG                                 **</span>
<a name="l00006"></a>00006 <span class="comment"> All rights reserved.                                                         **</span>
<a name="l00007"></a>00007 <span class="comment">                                                                              **</span>
<a name="l00008"></a>00008 <span class="comment"> Redistribution and use in source and binary forms, with or without           **</span>
<a name="l00009"></a>00009 <span class="comment"> modification,are permitted provided that the following conditions are met:   **</span>
<a name="l00010"></a>00010 <span class="comment">                                                                              **</span>
<a name="l00011"></a>00011 <span class="comment"> *Redistributions of source code must retain the above copyright notice,      **</span>
<a name="l00012"></a>00012 <span class="comment"> this list of conditions and the following disclaimer.                        **</span>
<a name="l00013"></a>00013 <span class="comment"> *Redistributions in binary form must reproduce the above copyright notice,   **</span>
<a name="l00014"></a>00014 <span class="comment"> this list of conditions and the following disclaimer in the documentation    **</span>
<a name="l00015"></a>00015 <span class="comment"> and/or other materials provided with the distribution.                       **</span>
<a name="l00016"></a>00016 <span class="comment"> *Neither the name of the copyright holders nor the names of its contributors **</span>
<a name="l00017"></a>00017 <span class="comment"> may be used to endorse or promote products derived from this software without** </span>
<a name="l00018"></a>00018 <span class="comment"> specific prior written permission.                                           **</span>
<a name="l00019"></a>00019 <span class="comment">                                                                              **</span>
<a name="l00020"></a>00020 <span class="comment"> THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;  **</span>
<a name="l00021"></a>00021 <span class="comment"> AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE    **</span>
<a name="l00022"></a>00022 <span class="comment"> IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE   **</span>
<a name="l00023"></a>00023 <span class="comment"> ARE  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE   **</span>
<a name="l00024"></a>00024 <span class="comment"> LIABLE  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR         **</span>
<a name="l00025"></a>00025 <span class="comment"> CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF         **</span>
<a name="l00026"></a>00026 <span class="comment"> SUBSTITUTE GOODS OR  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS    **</span>
<a name="l00027"></a>00027 <span class="comment"> INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN      **</span>
<a name="l00028"></a>00028 <span class="comment"> CONTRACT, STRICT LIABILITY,OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)       **</span>
<a name="l00029"></a>00029 <span class="comment"> ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE   **</span>
<a name="l00030"></a>00030 <span class="comment"> POSSIBILITY OF SUCH DAMAGE.                                                  **</span>
<a name="l00031"></a>00031 <span class="comment">                                                                              **</span>
<a name="l00032"></a>00032 <span class="comment"> To improve the quality of the software, users are encouraged to share        **</span>
<a name="l00033"></a>00033 <span class="comment"> modifications, enhancements or bug fixes with Infineon Technologies AG       **</span>
<a name="l00034"></a>00034 <span class="comment"> dave@infineon.com).                                                          **</span>
<a name="l00035"></a>00035 <span class="comment">                                                                              **</span>
<a name="l00036"></a>00036 <span class="comment">********************************************************************************</span>
<a name="l00037"></a>00037 <span class="comment">**                                                                            **</span>
<a name="l00038"></a>00038 <span class="comment">**                                                                            **</span>
<a name="l00039"></a>00039 <span class="comment">** PLATFORM : Infineon XMC4000 Series                                         **</span>
<a name="l00040"></a>00040 <span class="comment">**                                                                            **</span>
<a name="l00041"></a>00041 <span class="comment">** COMPILER : Compiler Independent                                            **</span>
<a name="l00042"></a>00042 <span class="comment">**                                                                            **</span>
<a name="l00043"></a>00043 <span class="comment">** AUTHOR : App Developer                                                     **</span>
<a name="l00044"></a>00044 <span class="comment">**                                                                            **</span>
<a name="l00045"></a>00045 <span class="comment">** MAY BE CHANGED BY USER [yes/no]: Yes                                       **</span>
<a name="l00046"></a>00046 <span class="comment">**                                                                            **</span>
<a name="l00047"></a>00047 <span class="comment">** MODIFICATION DATE : Dec 16, 2011                                           **</span>
<a name="l00048"></a>00048 <span class="comment">**                                                                            **</span>
<a name="l00049"></a>00049 <span class="comment">*******************************************************************************/</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">/*******************************************************************************</span>
<a name="l00052"></a>00052 <span class="comment">**                       Author(s) Identity                                   **</span>
<a name="l00053"></a>00053 <span class="comment">********************************************************************************</span>
<a name="l00054"></a>00054 <span class="comment">**                                                                            **</span>
<a name="l00055"></a>00055 <span class="comment">** Initials    Name                                                           **</span>
<a name="l00056"></a>00056 <span class="comment">** ---------------------------------------------------------------------------**</span>
<a name="l00057"></a>00057 <span class="comment">** SK          App Developer                                                  **</span>
<a name="l00058"></a>00058 <span class="comment">*******************************************************************************/</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00070"></a>00070 <span class="comment">/*******************************************************************************</span>
<a name="l00071"></a>00071 <span class="comment">**                      INCLUDE FILES                                         **</span>
<a name="l00072"></a>00072 <span class="comment">*******************************************************************************/</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;DAVE3.h&gt;</span>
<a name="l00074"></a>00074 
<a name="l00078"></a>00078 <span class="comment">/*******************************************************************************</span>
<a name="l00079"></a>00079 <span class="comment">**                      Global Variable Definitions                           **</span>
<a name="l00080"></a>00080 <span class="comment">*******************************************************************************/</span>
<a name="l00089"></a>00089 <span class="keyword">static</span> uint8_t SDMMC002_InitializeFlag;
<a name="l00094"></a>00094 <span class="keyword">static</span> uint8_t SDMMC002_LockFlag;
<a name="l00095"></a>00095 <span class="preprocessor">#ifdef SDMMC002_UVP_TEST</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>  <span class="keywordtype">bool</span>  CardNotInit = FALSE;
<a name="l00097"></a>00097 <span class="preprocessor">#endif</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00105"></a>00105 <span class="comment">/*******************************************************************************</span>
<a name="l00106"></a>00106 <span class="comment">**                     Private Function Declarations                           **</span>
<a name="l00107"></a>00107 <span class="comment">*******************************************************************************/</span>
<a name="l00118"></a>00118 uint8_t SDMMC002_lFindDiskStatus(<span class="keywordtype">void</span>);
<a name="l00119"></a>00119 
<a name="l00123"></a>00123 <span class="comment">/*******************************************************************************</span>
<a name="l00124"></a>00124 <span class="comment">**                     Private Function Definitions                           **</span>
<a name="l00125"></a>00125 <span class="comment">*******************************************************************************/</span>
<a name="l00126"></a>00126 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_nonAPI_1&gt;&gt;&gt;*/</span>
<a name="l00127"></a>00127 uint8_t SDMMC002_lFindDiskStatus()
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129   status_t Status;
<a name="l00130"></a>00130   uint8_t DiskStatus = 0;
<a name="l00131"></a>00131 <span class="comment">/* Get the Status Information */</span>
<a name="l00132"></a>00132   <span class="keywordflow">do</span>
<a name="l00133"></a>00133   {
<a name="l00134"></a>00134  <span class="comment">/* Get the Current State information . */</span>
<a name="l00135"></a>00135     Status = SDMMC004_GetCurrentState();
<a name="l00136"></a>00136 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_nonAPI_1_1&gt;&gt;&gt;*/</span>
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (Status &amp; (uint32_t)SDMMC004_STATE_NO_CARD )
<a name="l00138"></a>00138     {
<a name="l00139"></a>00139       DiskStatus = (<a class="code" href="group___s_d_m_m_c002__publicparam.html#ga463a2b1fd5820033a35082a9b0328f68">SDMMC002_STA_NOINIT</a> | <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga7f1583c319c379971b23086d0242a1ab">SDMMC002_STA_NODISK</a>);
<a name="l00140"></a>00140       <span class="keywordflow">break</span>;
<a name="l00141"></a>00141     }<span class="comment">/* End of &quot;if ((Status &amp; SDMMC004_STATE_CARD_INSERTED) == 0)&quot;    */</span>
<a name="l00142"></a>00142 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_nonAPI_1_2&gt;&gt;&gt;*/</span>
<a name="l00143"></a>00143     <span class="keywordflow">if</span> ((Status &amp; (uint32_t)SDMMC004_STATE_CARD_INITIALIZED) == 0)
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145       DiskStatus |= <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga463a2b1fd5820033a35082a9b0328f68">SDMMC002_STA_NOINIT</a>;
<a name="l00146"></a>00146       <span class="keywordflow">break</span>;
<a name="l00147"></a>00147     }<span class="comment">/* End of &quot;if ((Status &amp; SDMMC004_STATE_CARD_INITIALIZED) == 0)&quot; */</span>
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (( Status &amp; (uint32_t)SDMMC004_STATE_CARD_LOCKED) != 0 )
<a name="l00149"></a>00149     {
<a name="l00150"></a>00150       SDMMC002_LockFlag = 1;
<a name="l00151"></a>00151       DiskStatus |= <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga463a2b1fd5820033a35082a9b0328f68">SDMMC002_STA_NOINIT</a>;
<a name="l00152"></a>00152       <span class="keywordflow">break</span>;
<a name="l00153"></a>00153     }<span class="comment">/* End of &quot;if ((Status &amp; (uint32_t)SDMMC004_STATE_CARD_LOCKED) == 0)&quot; */</span>
<a name="l00154"></a>00154 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_nonAPI_1_3&gt;&gt;&gt;*/</span>
<a name="l00155"></a>00155     <span class="keywordflow">if</span> ((Status &amp; (uint32_t)SDMMC004_STATE_CARD_WRITE_PROTECT) != 0)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       DiskStatus |= <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga10630c029f7ee72d5030b37534e609af">SDMMC002_STA_PROTECT</a>;
<a name="l00158"></a>00158     }<span class="comment">/* End of &quot;if ((Status &amp; SDMMC004_STATE_CARD_WRITE_PROTECT) != 0)&quot; */</span>
<a name="l00159"></a>00159   } <span class="keywordflow">while</span>(0);
<a name="l00160"></a>00160   <span class="keywordflow">return</span> DiskStatus;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00167"></a>00167 <span class="comment">/*******************************************************************************</span>
<a name="l00168"></a>00168 <span class="comment">**                     Public Function Definitions                            **</span>
<a name="l00169"></a>00169 <span class="comment">*******************************************************************************/</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_1&gt;&gt;&gt;*/</span>
<a name="l00172"></a>00172 <span class="comment">/*</span>
<a name="l00173"></a>00173 <span class="comment"> * The function checks and returns the initialization status of the card .</span>
<a name="l00174"></a>00174 <span class="comment"> */</span>
<a name="l00175"></a><a class="code" href="group___s_d_m_m_c002__apidoc.html#ga0b8683e0c2b0bec0129e92f5888d91d1">00175</a> uint8_t <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga0b8683e0c2b0bec0129e92f5888d91d1" title="This function initializes the SD/MMC card and returns the initialization status of the card...">SDMMC002_Initialize</a>(<span class="keywordtype">void</span>)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177   status_t Status;
<a name="l00178"></a>00178   uint8_t DiskStatus ;
<a name="l00179"></a>00179   FUNCTION_ENTRY(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a8c25ff91eea84861d60a415bca22c33d">SDMMC002_FUNCTION_ENTRY</a>);
<a name="l00180"></a>00180   <span class="keywordflow">do</span>
<a name="l00181"></a>00181   {
<a name="l00182"></a>00182 <span class="preprocessor">#ifdef SDMMC002_UVP_TEST</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CardNotInit == TRUE)
<a name="l00184"></a>00184     {
<a name="l00185"></a>00185       SDMMC002_InitializeFlag =1 ;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 <span class="preprocessor">#endif</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>    <span class="comment">/* Check the device initialization status. If SDMMC device is</span>
<a name="l00189"></a>00189 <span class="comment">     * already initialized, Skip this step else initialize Sdmmc device */</span>
<a name="l00190"></a>00190     <span class="keywordflow">if</span> ( SDMMC002_InitializeFlag == 0)
<a name="l00191"></a>00191     {
<a name="l00192"></a>00192       Status = SDMMC004_Start();
<a name="l00193"></a>00193       <span class="keywordflow">if</span> ( (Status != (uint32_t)DAVEApp_SUCCESS) &amp;&amp;  \
<a name="l00194"></a>00194            (Status != (uint32_t)SDMMC004_HOST_CONTROLLER_INITIALIZED))
<a name="l00195"></a>00195       {
<a name="l00196"></a>00196         <span class="keywordflow">break</span>;
<a name="l00197"></a>00197       }
<a name="l00198"></a>00198       Status = SDMMC004_CardDetectionSupport();
<a name="l00199"></a>00199       <span class="keywordflow">if</span> (Status != (uint32_t)DAVEApp_SUCCESS )
<a name="l00200"></a>00200       {
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (Status == (uint32_t)SDMMC004_INITIALIZED_BUT_LOCKED)
<a name="l00202"></a>00202         {
<a name="l00203"></a>00203           SDMMC002_LockFlag = 1;
<a name="l00204"></a>00204         }
<a name="l00205"></a>00205         <span class="keywordflow">break</span>;
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207       SDMMC002_InitializeFlag = 1; 
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209   } <span class="keywordflow">while</span>(0);
<a name="l00210"></a>00210 <span class="comment">/* Debug Log Message */</span>
<a name="l00211"></a>00211   DiskStatus =  SDMMC002_lFindDiskStatus();
<a name="l00212"></a>00212   ERROR(GID_SDMMC002,Status,0,0);
<a name="l00213"></a>00213   FUNCTION_EXIT(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a0e90a392004ad34df5f4a59ff625de22">SDMMC002_FUNCTION_EXIT</a>);
<a name="l00214"></a>00214   <span class="keywordflow">return</span> DiskStatus;
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_2&gt;&gt;&gt;*/</span>
<a name="l00218"></a>00218 <span class="comment">/*</span>
<a name="l00219"></a>00219 <span class="comment"> * The function gets the status of the card whether the card is initialized,</span>
<a name="l00220"></a>00220 <span class="comment"> * inserted or write protected.</span>
<a name="l00221"></a>00221 <span class="comment"> */</span>
<a name="l00222"></a><a class="code" href="_s_d_m_m_c002_8c.html#a5fb891882fa908fdffbe31f34a0996d5">00222</a> uint8_t <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga5fb891882fa908fdffbe31f34a0996d5" title="This function gets the current card&#39;s status like whether device is initialized, whether device is in...">SDMMC002_GetStatus</a>(<span class="keywordtype">void</span>)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   uint8_t  DiskStatus;
<a name="l00225"></a>00225   FUNCTION_ENTRY(GID_SDMMC002,(uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a8c25ff91eea84861d60a415bca22c33d">SDMMC002_FUNCTION_ENTRY</a>);
<a name="l00226"></a>00226   DiskStatus  = <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga0b8683e0c2b0bec0129e92f5888d91d1" title="This function initializes the SD/MMC card and returns the initialization status of the card...">SDMMC002_Initialize</a>();
<a name="l00227"></a>00227   FUNCTION_EXIT(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a0e90a392004ad34df5f4a59ff625de22">SDMMC002_FUNCTION_EXIT</a>);
<a name="l00228"></a>00228   <span class="keywordflow">return</span> DiskStatus;
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">/* &lt;&lt;&lt;DD_SDMMC002_API_3&gt;&gt;&gt;*/</span>
<a name="l00232"></a>00232 <span class="comment">/*</span>
<a name="l00233"></a>00233 <span class="comment"> * The function reads the data from the card.</span>
<a name="l00234"></a>00234 <span class="comment"> */</span>
<a name="l00235"></a>00235 uint32_t <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga1c77bfb492a5628954497c90b4980235" title="This function reads blocks of data from the card. Block read can be single or multiple blocks...">SDMMC002_ReadBlock</a>
<a name="l00236"></a><a class="code" href="_s_d_m_m_c002_8c.html#a1c77bfb492a5628954497c90b4980235">00236</a> (
<a name="l00237"></a>00237   uint8_t *ReadBuf,
<a name="l00238"></a>00238   uint32_t SectorNumber,
<a name="l00239"></a>00239   uint8_t  SectorCount
<a name="l00240"></a>00240 )
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242   status_t Status;
<a name="l00243"></a>00243   uint8_t DiskStatus;
<a name="l00244"></a>00244   uint32_t Result;
<a name="l00245"></a>00245   FUNCTION_ENTRY(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a8c25ff91eea84861d60a415bca22c33d">SDMMC002_FUNCTION_ENTRY</a>);
<a name="l00246"></a>00246 <span class="comment">/* Check the status before reading data */</span>
<a name="l00247"></a>00247   DiskStatus = <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga5fb891882fa908fdffbe31f34a0996d5" title="This function gets the current card&#39;s status like whether device is initialized, whether device is in...">SDMMC002_GetStatus</a>();
<a name="l00248"></a>00248 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_3_1&gt;&gt;&gt;*/</span>
<a name="l00249"></a>00249   <span class="keywordflow">if</span> ((DiskStatus &amp; (uint8_t)<a class="code" href="group___s_d_m_m_c002__publicparam.html#ga463a2b1fd5820033a35082a9b0328f68">SDMMC002_STA_NOINIT</a>) != 0)
<a name="l00250"></a>00250   {
<a name="l00251"></a>00251     Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gad7069cdd0b03fb09aa27700eabc8b6ff">SDMMC002_RES_NOTRDY</a>;
<a name="l00252"></a>00252     ERROR(GID_SDMMC002,Result,0,0);
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254   <span class="keywordflow">else</span>
<a name="l00255"></a>00255   {
<a name="l00256"></a>00256 <span class="comment">/*Check for single block read or multiple block read based on sector count */</span>
<a name="l00257"></a>00257 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_3_2&gt;&gt;&gt;*/</span>
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (SectorCount == 1)
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260       Status = SDMMC004_CardReadSingleBlock( (uint32_t *)ReadBuf, SectorNumber);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_3_3&gt;&gt;&gt;*/</span>
<a name="l00263"></a>00263     <span class="keywordflow">else</span>
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265       Status = SDMMC004_CardReadMultipleBlocks((uint32_t *)ReadBuf,SectorNumber, \
<a name="l00266"></a>00266                                                 SectorCount);
<a name="l00267"></a>00267     }<span class="comment">/*End of &quot;if (SectorCount == 1)&quot;*/</span>
<a name="l00268"></a>00268 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_3_4&gt;&gt;&gt;*/</span>
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (Status == (uint32_t)DAVEApp_SUCCESS)
<a name="l00270"></a>00270     {
<a name="l00271"></a>00271       Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gacf63aaa694dedf117de91e895ca1d3a3">SDMMC002_RES_OK</a>;
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_3_5&gt;&gt;&gt;*/</span>
<a name="l00274"></a>00274     <span class="keywordflow">else</span>
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276       Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gafaeb77ea63493e01e35a3d6dbb693b28">SDMMC002_RES_ERROR</a>;
<a name="l00277"></a>00277       ERROR(GID_SDMMC002,<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035ae761f646f876bb9e21530c6df5c83a26">SDMMC002_SDMMC00x_ERROR</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),Status);
<a name="l00278"></a>00278     }<span class="comment">/* End of &quot;if (Status == (uint32_t)DAVEApp_SUCCESS)&quot;*/</span>
<a name="l00279"></a>00279   }<span class="comment">/* End of &quot; if ((DiskStatus &amp; (uint8_t)STA_NOINIT) != 0)&quot;*/</span>
<a name="l00280"></a>00280   FUNCTION_EXIT(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a0e90a392004ad34df5f4a59ff625de22">SDMMC002_FUNCTION_EXIT</a>);
<a name="l00281"></a>00281   <span class="keywordflow">return</span> Result;
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4&gt;&gt;&gt;*/</span>
<a name="l00285"></a>00285 <span class="comment">/*</span>
<a name="l00286"></a>00286 <span class="comment"> * The function writes the data on the card.</span>
<a name="l00287"></a>00287 <span class="comment"> */</span>
<a name="l00288"></a>00288 uint32_t <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga2c811f452e072e0806fd910dcee75142" title="This function writes the data blocks onto the card from the host system. Write operation may be for s...">SDMMC002_WriteBlock</a>
<a name="l00289"></a><a class="code" href="_s_d_m_m_c002_8c.html#a2c811f452e072e0806fd910dcee75142">00289</a> (
<a name="l00290"></a>00290   <span class="keyword">const</span> uint8_t *WriteBuf,
<a name="l00291"></a>00291   uint32_t SectorNumber,
<a name="l00292"></a>00292   uint8_t SectorCount
<a name="l00293"></a>00293 )
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295   status_t Status ;
<a name="l00296"></a>00296   uint8_t DiskStatus;
<a name="l00297"></a>00297   uint32_t Result;
<a name="l00298"></a>00298   FUNCTION_ENTRY(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a8c25ff91eea84861d60a415bca22c33d">SDMMC002_FUNCTION_ENTRY</a>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="keywordflow">do</span>
<a name="l00301"></a>00301   {
<a name="l00302"></a>00302     DiskStatus = <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga5fb891882fa908fdffbe31f34a0996d5" title="This function gets the current card&#39;s status like whether device is initialized, whether device is in...">SDMMC002_GetStatus</a> ();
<a name="l00303"></a>00303 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4_1&gt;&gt;&gt;*/</span>
<a name="l00304"></a>00304 <span class="comment">/* If the card is not initialized */</span>
<a name="l00305"></a>00305     <span class="keywordflow">if</span> ((DiskStatus &amp; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga463a2b1fd5820033a35082a9b0328f68">SDMMC002_STA_NOINIT</a>) != 0)
<a name="l00306"></a>00306     {
<a name="l00307"></a>00307       Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gad7069cdd0b03fb09aa27700eabc8b6ff">SDMMC002_RES_NOTRDY</a>;
<a name="l00308"></a>00308       ERROR(GID_SDMMC002,Result,0,0);
<a name="l00309"></a>00309       <span class="keywordflow">break</span>;
<a name="l00310"></a>00310     }<span class="comment">/* End of &quot;if ((DiskStatus &amp; SDMMC002_STA_NOINIT) != 0)&quot;*/</span>
<a name="l00311"></a>00311 <span class="comment">/* If the card is read only or write protected */</span>
<a name="l00312"></a>00312 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4_2&gt;&gt;&gt;*/</span>
<a name="l00313"></a>00313     <span class="keywordflow">if</span> ((DiskStatus &amp; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga10630c029f7ee72d5030b37534e609af">SDMMC002_STA_PROTECT</a>) != 0)
<a name="l00314"></a>00314     {
<a name="l00315"></a>00315       Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga645d2ccdad691cccc30a0a5ce2d710fa">SDMMC002_RES_WRPRT</a>;
<a name="l00316"></a>00316       ERROR(GID_SDMMC002,Result,0,0);
<a name="l00317"></a>00317       <span class="keywordflow">break</span>;
<a name="l00318"></a>00318     }<span class="comment">/* End of &quot;if ((DiskStatus &amp; SDMMC002_STA_PROTECT) != 0)&quot;*/</span>
<a name="l00319"></a>00319 <span class="comment">/*Check for single block write or multiple block write.*/</span>
<a name="l00320"></a>00320 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4_3&gt;&gt;&gt;*/</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (SectorCount == 1)
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323       Status = SDMMC004_CardWriteSingleBlock((uint32_t *)WriteBuf, SectorNumber);
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4_4&gt;&gt;&gt;*/</span>
<a name="l00326"></a>00326     <span class="keywordflow">else</span>
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328       Status = SDMMC004_CardWriteMultipleBlocks((uint32_t *)WriteBuf,\
<a name="l00329"></a>00329                                                  SectorNumber, SectorCount );
<a name="l00330"></a>00330     } <span class="comment">/* End of &quot;if (SectorCount == 1)&quot;*/</span>
<a name="l00331"></a>00331 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4_5&gt;&gt;&gt;*/</span>
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (Status == (uint32_t)DAVEApp_SUCCESS)
<a name="l00333"></a>00333     {
<a name="l00334"></a>00334       Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gacf63aaa694dedf117de91e895ca1d3a3">SDMMC002_RES_OK</a>;
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_4_6&gt;&gt;&gt;*/</span>
<a name="l00337"></a>00337     <span class="keywordflow">else</span>
<a name="l00338"></a>00338     {
<a name="l00339"></a>00339       Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gafaeb77ea63493e01e35a3d6dbb693b28">SDMMC002_RES_ERROR</a>;
<a name="l00340"></a>00340       ERROR(GID_SDMMC002,<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035ae761f646f876bb9e21530c6df5c83a26">SDMMC002_SDMMC00x_ERROR</a>,0,0);
<a name="l00341"></a>00341     } <span class="comment">/* End of &quot;if (Status == (uint32_t)DAVEApp_SUCCESS)&quot;*/</span>
<a name="l00342"></a>00342   } <span class="keywordflow">while</span>(0);
<a name="l00343"></a>00343   FUNCTION_EXIT(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a0e90a392004ad34df5f4a59ff625de22">SDMMC002_FUNCTION_EXIT</a>);
<a name="l00344"></a>00344   <span class="keywordflow">return</span> Result;
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5&gt;&gt;&gt;*/</span>
<a name="l00348"></a>00348 <span class="comment">/*</span>
<a name="l00349"></a>00349 <span class="comment"> * The function performs the various IOCTL operation.</span>
<a name="l00350"></a>00350 <span class="comment"> */</span>
<a name="l00351"></a>00351 uint32_t <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga8929eee92c986d37f37e75f5f679a576" title="This function controls SDMMC device specified features and the device independent miscellaneous funct...">SDMMC002_Ioctl</a>
<a name="l00352"></a><a class="code" href="_s_d_m_m_c002_8c.html#a8929eee92c986d37f37e75f5f679a576">00352</a> (
<a name="l00353"></a>00353   uint8_t Command,
<a name="l00354"></a>00354   <span class="keywordtype">void</span> *Buffer
<a name="l00355"></a>00355 )
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   status_t Status = (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a8e7f86783a35a91b2fe3171e840e9d13">SDMMC002_ERROR</a>;
<a name="l00358"></a>00358   uint8_t DiskStatus;
<a name="l00359"></a>00359   uint32_t Result;
<a name="l00360"></a>00360   <a class="code" href="struct_s_d_m_m_c002___erase_addr_type.html">SDMMC002_EraseAddrType</a> *ErasePtr;
<a name="l00361"></a>00361   <span class="keyword">const</span> <a class="code" href="struct_s_d_m_m_c002___passwd_type.html">SDMMC002_PasswdType</a> *PasswdPtr;
<a name="l00362"></a>00362   SDMMC004_LocalLockStructType LockStruct = {0};
<a name="l00363"></a>00363   FUNCTION_ENTRY(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a8c25ff91eea84861d60a415bca22c33d">SDMMC002_FUNCTION_ENTRY</a>);
<a name="l00364"></a>00364   <span class="keywordflow">do</span>
<a name="l00365"></a>00365   {
<a name="l00366"></a>00366     DiskStatus = <a class="code" href="group___s_d_m_m_c002__apidoc.html#ga5fb891882fa908fdffbe31f34a0996d5" title="This function gets the current card&#39;s status like whether device is initialized, whether device is in...">SDMMC002_GetStatus</a>();
<a name="l00367"></a>00367 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_1&gt;&gt;&gt;*/</span>
<a name="l00368"></a>00368 <span class="comment">/* If card is not initialized or inserted */</span>
<a name="l00369"></a>00369     <span class="keywordflow">if</span> ((DiskStatus &amp; (uint8_t)<a class="code" href="group___s_d_m_m_c002__publicparam.html#ga463a2b1fd5820033a35082a9b0328f68">SDMMC002_STA_NOINIT</a>) != 0)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371       <span class="keywordflow">if</span> (SDMMC002_LockFlag == 1UL)
<a name="l00372"></a>00372       {
<a name="l00373"></a>00373         Status = (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a750c2ee8848786c65b0d37ddbc223d69">SDMMC002_DISK_LOCKED</a>;
<a name="l00374"></a>00374         <span class="keywordflow">if</span> ( (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaa66c38de742f4bea6dfb43d66112f32a">SDMMC002_MMC_UNLOCK_CARD</a>) &amp;&amp;
<a name="l00375"></a>00375            (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaab61d880df387bf801aae682dd85168f">SDMMC002_MMC_SET_PASSWD</a>) &amp;&amp;
<a name="l00376"></a>00376            (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gadf58b08156263f80e09e64c6b9da7033">SDMMC002_MMC_CLEAR_PASSWD</a>) &amp;&amp;
<a name="l00377"></a>00377            (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaebb0292e4c0179eebe8716c38d586d79">SDMMC002_MMC_SET_LOCK</a>) &amp;&amp;
<a name="l00378"></a>00378            (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaad8384d52055636e5ffbcb72f8ddd846">SDMMC002_MMC_READ_LOCK_STATUS</a>) &amp;&amp;
<a name="l00379"></a>00379            (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaf947b12600d095ddcdf119a92f0a6ebc">SDMMC002_MMC_FORCE_ERASE</a>) &amp;&amp;
<a name="l00380"></a>00380            (Command != <a class="code" href="group___s_d_m_m_c002__publicparam.html#gabf0d8c56ea415fcb0559df748afd4669">SDMMC002_CTRL_EJECT</a>) )
<a name="l00381"></a>00381         {
<a name="l00382"></a>00382           ERROR(GID_SDMMC001,Status,0,0);
<a name="l00383"></a>00383           <span class="keywordflow">break</span>;
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385       }
<a name="l00386"></a>00386       <span class="keywordflow">else</span>
<a name="l00387"></a>00387       {
<a name="l00388"></a>00388         Status = (uint32_t)<a class="code" href="group___s_d_m_m_c002__publicparam.html#gad7069cdd0b03fb09aa27700eabc8b6ff">SDMMC002_RES_NOTRDY</a>;
<a name="l00389"></a>00389         ERROR(GID_SDMMC001,Status,0,0);
<a name="l00390"></a>00390         <span class="keywordflow">break</span>;
<a name="l00391"></a>00391       }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 <span class="comment">/* Switch to the respective IOCTL command */</span>
<a name="l00394"></a>00394     <span class="keywordflow">switch</span> (Command)
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_2&gt;&gt;&gt;*/</span>
<a name="l00397"></a>00397       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gace88d9a4b69ff24a4e5e9b86afb7504e">SDMMC002_CTRL_SYNC</a>:
<a name="l00398"></a>00398         Status = SDMMC004_FlushDiskWriteCache();
<a name="l00399"></a>00399         <span class="keywordflow">break</span>;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaf7fb343a233343dfc4529fa6ff8bf568">SDMMC002_GET_SECTOR_SIZE</a>:
<a name="l00402"></a>00402         Status = SDMMC004_GetSectorSize(Buffer);
<a name="l00403"></a>00403                 <span class="keywordflow">break</span>;
<a name="l00404"></a>00404                  
<a name="l00405"></a>00405 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_3&gt;&gt;&gt;*/</span>
<a name="l00406"></a>00406       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gacf2d9454c34ecbc86e8de3a9b39ef852">SDMMC002_GET_SECTOR_COUNT</a>:
<a name="l00407"></a>00407         Status = SDMMC004_GetSectorCount( Buffer );
<a name="l00408"></a>00408         <span class="keywordflow">break</span>;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_4&gt;&gt;&gt;*/</span>
<a name="l00411"></a>00411       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga0cb9c46aefcacaf6f9ccbd739a8e3464">SDMMC002_CTRL_ERASE_SECTOR</a>:
<a name="l00412"></a>00412         ErasePtr = (<a class="code" href="struct_s_d_m_m_c002___erase_addr_type.html">SDMMC002_EraseAddrType</a> *) Buffer;
<a name="l00413"></a>00413         Status = SDMMC004_EraseBlock( (ErasePtr-&gt;<a class="code" href="struct_s_d_m_m_c002___erase_addr_type.html#a66cc695d31bc04f426eed0658a88106d">StartAddress</a>),
<a name="l00414"></a>00414                                       (ErasePtr-&gt;<a class="code" href="struct_s_d_m_m_c002___erase_addr_type.html#aa3b09b75918741eae13c418d4e9098ab">EndAddress</a>));
<a name="l00415"></a>00415         <span class="keywordflow">break</span>;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_5&gt;&gt;&gt;*/</span>
<a name="l00418"></a>00418       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga86d7fa0069b4161896f700c2c37a79ed">SDMMC002_GET_BLOCK_SIZE</a>:
<a name="l00419"></a>00419         Status = SDMMC004_GetBlockSize(Buffer);
<a name="l00420"></a>00420         <span class="keywordflow">break</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_6&gt;&gt;&gt;*/</span>
<a name="l00423"></a>00423       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga865b3274f45b1a89614b56942582dd6d">SDMMC002_MMC_GET_TYPE</a>:
<a name="l00424"></a>00424         Status = SDMMC004_GetCardType(Buffer);
<a name="l00425"></a>00425         <span class="keywordflow">break</span>;
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_7&gt;&gt;&gt;*/</span>
<a name="l00428"></a>00428       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gae7b68bc197a2064d527d6abc3c321738">SDMMC002_MMC_GET_CSD</a>:
<a name="l00429"></a>00429         Status = SDMMC004_GetCsd(Buffer);
<a name="l00430"></a>00430         <span class="keywordflow">break</span>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_8&gt;&gt;&gt;*/</span>
<a name="l00433"></a>00433       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga2814220d965e426cdbaf08e262a5fb8a">SDMMC002_MMC_GET_CID</a>:
<a name="l00434"></a>00434         Status = SDMMC004_GetCid(Buffer);
<a name="l00435"></a>00435         <span class="keywordflow">break</span>;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_8&gt;&gt;&gt;*/</span>
<a name="l00438"></a>00438       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gabd01c670522450e8bedbbebca06a414f">SDMMC002_MMC_GET_OCR</a>:
<a name="l00439"></a>00439         Status = SDMMC004_GetOcr(Buffer);
<a name="l00440"></a>00440         <span class="keywordflow">break</span>;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_10&gt;&gt;&gt;*/</span>
<a name="l00443"></a>00443       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga4a36890663d4fb85784d09ddf14462b4">SDMMC002_MMC_GET_SDSTAT</a>:
<a name="l00444"></a>00444         Status = SDMMC004_GetSdStatus(Buffer);
<a name="l00445"></a>00445         <span class="keywordflow">break</span>;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_11&gt;&gt;&gt;*/</span>
<a name="l00448"></a>00448       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gae4723e47b4898e875752f5438fc9d68f">SDMMC002_MMC_LOCK_CARD</a>:
<a name="l00449"></a>00449         LockStruct.Mode = 0x04UL;
<a name="l00450"></a>00450         PasswdPtr = (<span class="keyword">const</span> <a class="code" href="struct_s_d_m_m_c002___passwd_type.html">SDMMC002_PasswdType</a> *)Buffer;
<a name="l00451"></a>00451         <span class="comment">/* Check password length doesn&#39;t exceeds the permitted length */</span>
<a name="l00452"></a>00452         <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_11_1&gt;&gt;&gt;*/</span>
<a name="l00453"></a>00453         <span class="keywordflow">if</span>( PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> &gt; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga5cd689e4e52431f39be0ec00a22bc29b">SDMMC002_MAX_PASSWD_LEN</a> )
<a name="l00454"></a>00454         {
<a name="l00455"></a>00455           <span class="keywordflow">break</span>;
<a name="l00456"></a>00456         }
<a name="l00457"></a>00457         LockStruct.PwdLen = PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a>;
<a name="l00458"></a>00458         memcpy(LockStruct.PwdData, PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a5e5f040af93df19c9dcc0ba7c05d7b9e">OldPassword</a>, \
<a name="l00459"></a>00459                (uint32_t)LockStruct.PwdLen);
<a name="l00460"></a>00460         Status = SDMMC004_LockUnlockCard(&amp;LockStruct, SDMMC004_LOCK);
<a name="l00461"></a>00461         <span class="keywordflow">break</span>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_12&gt;&gt;&gt;*/</span>
<a name="l00464"></a>00464       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaa66c38de742f4bea6dfb43d66112f32a">SDMMC002_MMC_UNLOCK_CARD</a>:
<a name="l00465"></a>00465         LockStruct.Mode = 0x00UL;
<a name="l00466"></a>00466         PasswdPtr = (<span class="keyword">const</span> <a class="code" href="struct_s_d_m_m_c002___passwd_type.html">SDMMC002_PasswdType</a> *)Buffer;
<a name="l00467"></a>00467         <span class="comment">/* Check password length doesn&#39;t exceeds the permitted length */</span>
<a name="l00468"></a>00468         <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_12_1&gt;&gt;&gt;*/</span>
<a name="l00469"></a>00469         <span class="keywordflow">if</span>( PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> &gt; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga5cd689e4e52431f39be0ec00a22bc29b">SDMMC002_MAX_PASSWD_LEN</a> )
<a name="l00470"></a>00470         {
<a name="l00471"></a>00471           <span class="keywordflow">break</span>;
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473         LockStruct.PwdLen = PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a>;
<a name="l00474"></a>00474         memcpy(LockStruct.PwdData,PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a5e5f040af93df19c9dcc0ba7c05d7b9e">OldPassword</a>, LockStruct.PwdLen);
<a name="l00475"></a>00475         Status  = SDMMC004_LockUnlockCard(&amp;LockStruct,  \
<a name="l00476"></a>00476                                           SDMMC004_UNLOCK);
<a name="l00477"></a>00477         <span class="keywordflow">break</span>;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_13&gt;&gt;&gt;*/</span>
<a name="l00480"></a>00480       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaab61d880df387bf801aae682dd85168f">SDMMC002_MMC_SET_PASSWD</a>:
<a name="l00481"></a>00481 <span class="comment">/*Fill the local lock structure with the information provided*/</span>
<a name="l00482"></a>00482         LockStruct.Mode  = 0x01UL;
<a name="l00483"></a>00483         PasswdPtr = (<span class="keyword">const</span> <a class="code" href="struct_s_d_m_m_c002___passwd_type.html">SDMMC002_PasswdType</a> *)Buffer;
<a name="l00484"></a>00484         <span class="comment">/* Check password length doesn&#39;t exceeds the permitted length */</span>
<a name="l00485"></a>00485         <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_13_1&gt;&gt;&gt;*/</span>
<a name="l00486"></a>00486         <span class="keywordflow">if</span>( (PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> &gt; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga5cd689e4e52431f39be0ec00a22bc29b">SDMMC002_MAX_PASSWD_LEN</a>) ||
<a name="l00487"></a>00487             (PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a11693ba3c02b1c0e195e0cd5f9430b28">NewPwdLength</a> &gt; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga5cd689e4e52431f39be0ec00a22bc29b">SDMMC002_MAX_PASSWD_LEN</a> ))
<a name="l00488"></a>00488         {
<a name="l00489"></a>00489           <span class="keywordflow">break</span>;
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491         LockStruct.PwdLen = PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> + PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a11693ba3c02b1c0e195e0cd5f9430b28">NewPwdLength</a>;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         memcpy(LockStruct.PwdData, PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a5e5f040af93df19c9dcc0ba7c05d7b9e">OldPassword</a>, \
<a name="l00494"></a>00494                 PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> );
<a name="l00495"></a>00495         memcpy(LockStruct.PwdData + PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a>, \
<a name="l00496"></a>00496                PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a9cdb235a722f251eaa4d342d9acf83e6">NewPassword</a>, PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a11693ba3c02b1c0e195e0cd5f9430b28">NewPwdLength</a> );
<a name="l00497"></a>00497 
<a name="l00498"></a>00498         Status = SDMMC004_LockUnlockCard(&amp;LockStruct, \
<a name="l00499"></a>00499                                           SDMMC004_UNLOCK);
<a name="l00500"></a>00500         <span class="keywordflow">break</span>;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_14&gt;&gt;&gt;*/</span>
<a name="l00503"></a>00503       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gadf58b08156263f80e09e64c6b9da7033">SDMMC002_MMC_CLEAR_PASSWD</a>:
<a name="l00504"></a>00504         LockStruct.Mode  = 0x02UL;
<a name="l00505"></a>00505         PasswdPtr = (<span class="keyword">const</span> <a class="code" href="struct_s_d_m_m_c002___passwd_type.html">SDMMC002_PasswdType</a> *)Buffer;
<a name="l00506"></a>00506         <span class="comment">/* Check password length doesn&#39;t exceeds the permitted length */</span>
<a name="l00507"></a>00507         <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_14_1&gt;&gt;&gt;*/</span>
<a name="l00508"></a>00508         <span class="keywordflow">if</span>( PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> &gt; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga5cd689e4e52431f39be0ec00a22bc29b">SDMMC002_MAX_PASSWD_LEN</a> )
<a name="l00509"></a>00509         {
<a name="l00510"></a>00510           <span class="keywordflow">break</span>;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         LockStruct.PwdLen =  PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a>;
<a name="l00513"></a>00513         memcpy(LockStruct.PwdData, PasswdPtr -&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a5e5f040af93df19c9dcc0ba7c05d7b9e">OldPassword</a>, \
<a name="l00514"></a>00514                LockStruct.PwdLen);
<a name="l00515"></a>00515         Status = SDMMC004_LockUnlockCard(&amp;LockStruct,SDMMC004_UNLOCK);
<a name="l00516"></a>00516         <span class="keywordflow">break</span>;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_15&gt;&gt;&gt;*/</span>
<a name="l00519"></a>00519       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaebb0292e4c0179eebe8716c38d586d79">SDMMC002_MMC_SET_LOCK</a>:
<a name="l00520"></a>00520         LockStruct.Mode  = 0x05UL;
<a name="l00521"></a>00521         PasswdPtr = (<span class="keyword">const</span> <a class="code" href="struct_s_d_m_m_c002___passwd_type.html">SDMMC002_PasswdType</a> *)Buffer;
<a name="l00522"></a>00522         <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_15_1&gt;&gt;&gt;*/</span>
<a name="l00523"></a>00523         <span class="comment">/* Check password length doesn&#39;t exceeds the permitted length */</span>
<a name="l00524"></a>00524         <span class="keywordflow">if</span>( PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> &gt; <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga5cd689e4e52431f39be0ec00a22bc29b">SDMMC002_MAX_PASSWD_LEN</a> )
<a name="l00525"></a>00525         {
<a name="l00526"></a>00526           <span class="keywordflow">break</span>;
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528         LockStruct.PwdLen =  PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> + PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a11693ba3c02b1c0e195e0cd5f9430b28">NewPwdLength</a>;
<a name="l00529"></a>00529         memcpy(LockStruct.PwdData, PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a5e5f040af93df19c9dcc0ba7c05d7b9e">OldPassword</a>,PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a> );
<a name="l00530"></a>00530         memcpy(LockStruct.PwdData + PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#af826c4ecf0d4ec4a70f32c925323a73e">OldPwdLength</a>, \
<a name="l00531"></a>00531                        PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a9cdb235a722f251eaa4d342d9acf83e6">NewPassword</a>, PasswdPtr-&gt;<a class="code" href="struct_s_d_m_m_c002___passwd_type.html#a11693ba3c02b1c0e195e0cd5f9430b28">NewPwdLength</a> );
<a name="l00532"></a>00532         Status  = SDMMC004_LockUnlockCard(&amp;LockStruct, SDMMC004_LOCK);
<a name="l00533"></a>00533         <span class="keywordflow">break</span>;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_16&gt;&gt;&gt;*/</span>
<a name="l00536"></a>00536       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaad8384d52055636e5ffbcb72f8ddd846">SDMMC002_MMC_READ_LOCK_STATUS</a>:
<a name="l00537"></a>00537         Status = SDMMC004_GetLockStatus((uint32_t *)Buffer);
<a name="l00538"></a>00538         <span class="keywordflow">break</span>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_17&gt;&gt;&gt;*/</span>
<a name="l00541"></a>00541       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gaf947b12600d095ddcdf119a92f0a6ebc">SDMMC002_MMC_FORCE_ERASE</a>:
<a name="l00542"></a>00542         LockStruct.Mode = 0x08UL;
<a name="l00543"></a>00543         Status = SDMMC004_LockUnlockCard(&amp;LockStruct, SDMMC004_UNLOCK);
<a name="l00544"></a>00544         <span class="keywordflow">break</span>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_18&gt;&gt;&gt;*/</span>
<a name="l00547"></a>00547       <span class="keywordflow">case</span> <a class="code" href="group___s_d_m_m_c002__publicparam.html#gabf0d8c56ea415fcb0559df748afd4669">SDMMC002_CTRL_EJECT</a>:
<a name="l00548"></a>00548         Status = SDMMC004_EjectCard();
<a name="l00549"></a>00549         <span class="keywordflow">break</span>;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       <span class="keywordflow">default</span>:
<a name="l00552"></a>00552         Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#ga6e619d082df8196d84d4a7eae306af77">SDMMC002_RES_PARERR</a>;
<a name="l00553"></a>00553         <span class="keywordflow">break</span>;
<a name="l00554"></a>00554      }
<a name="l00555"></a>00555   } <span class="keywordflow">while</span> (0);
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_18&gt;&gt;&gt;*/</span>
<a name="l00558"></a>00558   <span class="keywordflow">if</span> (Status == (uint32_t)DAVEApp_SUCCESS)
<a name="l00559"></a>00559   {
<a name="l00560"></a>00560     Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gacf63aaa694dedf117de91e895ca1d3a3">SDMMC002_RES_OK</a>;
<a name="l00561"></a>00561   }
<a name="l00562"></a>00562 <span class="comment">/*&lt;&lt;&lt;DD_SDMMC002_API_5_19&gt;&gt;&gt;*/</span>
<a name="l00563"></a>00563   <span class="keywordflow">else</span>
<a name="l00564"></a>00564   {
<a name="l00565"></a>00565     Result = <a class="code" href="group___s_d_m_m_c002__publicparam.html#gafaeb77ea63493e01e35a3d6dbb693b28">SDMMC002_RES_ERROR</a>;
<a name="l00566"></a>00566     ERROR(GID_SDMMC002,<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035ae761f646f876bb9e21530c6df5c83a26">SDMMC002_SDMMC00x_ERROR</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),Status);
<a name="l00567"></a>00567   }
<a name="l00568"></a>00568   FUNCTION_EXIT(GID_SDMMC002, (uint32_t)<a class="code" href="_s_d_m_m_c002_8h.html#ga5e77f1e77da89311c678665853a3b035a0e90a392004ad34df5f4a59ff625de22">SDMMC002_FUNCTION_EXIT</a>);
<a name="l00569"></a>00569   <span class="keywordflow">return</span> Result;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="comment">/*CODE_BLOCK_END*/</span>
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 
</pre></div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<b>v1.0.0</b> Generated on Thu Sep 13 2012 16:12:30 for .&#160;<img class="footer" src="../image002.gif"/></small></address>
</body>
</html>
